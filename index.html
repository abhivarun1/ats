<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Aditya Tracking System</title>

<style>
    /* Basic page */
    body { font-family: Arial, sans-serif; background:#f2f4f8; margin:0; transition:0.3s; }
    /* Parent theme */
    .parent-theme { background: #fff4e0 !important; }

    /* Header */
    header {
        display:flex; flex-direction:column; align-items:center;
        gap:6px; padding:12px 10px;
        background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1);
        text-align:center;
    }
    header img { height:64px; }
    header h1 { font-size:26px; color:#003399; margin:0; }

    /* Login box */
    .login-box {
        width:360px; margin:36px auto; padding:20px;
        background:white; border-radius:12px;
        box-shadow:0 2px 10px rgba(0,0,0,0.12); text-align:center;
    }
    input, select {
        width:90%; padding:10px; margin:8px 0; font-size:15px;
        border-radius:6px; border:1px solid #bbb;
    }
    .login-box button {
        width:94%; padding:11px; margin-top:10px;
        background:#ff6b00; color:white; border:none; border-radius:6px;
        font-size:15px; cursor:pointer;
    }
    /* Parent variant for login box */
    .parent-box { border:2px solid orange; background:#fff7e6; }

    /* Dashboard */
    #dashboard { display:none; padding:18px; max-width:1100px; margin:0 auto; }
    #greeting { font-size:18px; color:#003399; font-weight:700; margin-bottom:10px; }

    /* Search */
    .search-wrap { position:relative; display:flex; justify-content:center; margin-bottom:8px; }
    #searchBar { width:320px; padding:10px; border-radius:6px; border:1px solid #aaa; font-size:15px; }
    #suggestions {
        position:absolute; top:44px; width:320px; background:white; border:1px solid #ccc;
        border-radius:6px; box-shadow:0 4px 12px rgba(0,0,0,0.08); display:none; z-index:50;
        max-height:220px; overflow:auto;
    }
    .suggest-item { padding:10px; cursor:pointer; }
    .suggest-item:hover { background:#f2f2f2; }

    /* Map + info */
    .layout { display:flex; gap:18px; flex-wrap:wrap; align-items:flex-start; }
    .map-box { flex:1 1 640px; background:white; padding:12px; border-radius:10px; box-shadow:0 3px 12px rgba(0,0,0,0.06); min-width:300px; }
    .info-box { flex:0 0 320px; min-width:260px; background:white; padding:12px; border-radius:10px; box-shadow:0 3px 12px rgba(0,0,0,0.06); }
    .info-item { margin-bottom:8px; }
    .info-item b { color:#333; }
    .notify-btn { padding:8px 12px; background:#ff6b00; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .route-btn { padding:8px 12px; background:#003399; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600; margin-left:8px; }

    /* Side route panel */
    #routePanel {
        position: fixed; top: 0; right: -420px; width: 420px; height: 100%;
        background: white; box-shadow: -4px 0 18px rgba(0,0,0,0.2);
        transition: 0.35s; z-index: 2000; padding:10px;
    }
    #routeHeader { display:flex; justify-content:space-between; align-items:center; background:#003399; color:white; padding:10px; border-radius:6px; }
    #routeHeader button { background:#ff4d4f; border:none; color:white; padding:6px 10px; border-radius:5px; cursor:pointer; }

    /* small screens */
    @media (max-width:880px) {
        .layout { flex-direction:column; }
        .map-box, .info-box { width:100%; }
        #routePanel { width:100%; right:-100%; }
    }
</style>
</head>
<body id="body">

<!-- HEADER -->
<header>
    <img src="mnt/data/adityaunilogo.png" alt="Aditya University Logo">
    <h1>Aditya Tracking System</h1>
</header>

<!-- LOGIN PAGE -->
<div id="loginPage" class="login-box">
    <h2>Select Login Type</h2>
    <select id="loginType" onchange="applyTheme()">
        <option value="student">Student Login</option>
        <option value="parent">Parent Login</option>
    </select>

    <input id="loginID" placeholder="Student ID / Parent Phone number" />
    <input id="password" placeholder="Password" type="password" />

    <button onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
    <div id="greeting"></div>

    <div class="search-wrap">
        <input id="searchBar" placeholder="Search for bus numberâ€¦" oninput="searchBus()" />
        <div id="suggestions"></div>
    </div>

    <div class="layout">
        <div class="map-box">
            <h3 style="margin:6px 0 10px 0">Live Bus Location</h3>
            <p id="allottedText" style="font-weight:700;color:#003399;margin:6px 0"></p>

            <!-- live google map iframe (no API key required) -->
            <iframe id="gmap" width="100%" height="350" style="border:0;border-radius:8px" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>

        <div class="info-box">
            <div class="info-item"><b id="labelAllotted">Allotted Bus:</b> <span id="busAllotted">â€”</span></div>
            <div class="info-item"><b>Showing Bus:</b> <span id="busNumber">â€”</span></div>
            <div class="info-item"><b>ETA:</b> <span id="eta">â€”</span></div>
            <div class="info-item"><b>Driver:</b> <span id="driver">â€”</span></div>
            <div class="info-item"><b>Driver Mobile:</b> <span id="mobile">â€”</span></div>

            <div style="margin-top:12px; display:flex; flex-direction:column; gap:12px;">
                <button class="notify-btn" onclick="notifyUser()">Notify when about to come.</button>
                <button class="route-btn" onclick="openRoutePanel()">Show Optimized Route</button>
            </div>
        </div>
    </div>
</div>

<!-- SIDE OPTIMIZED ROUTE PANEL -->
<div id="routePanel" aria-hidden="true">
    <div id="routeHeader">
        <div>Optimized Route Preview</div>
        <button onclick="closeRoutePanel()">Close</button>
    </div>
    <div style="margin-top:10px;">
        <iframe id="routeMap" width="100%" height="90%" style="border:0;border-radius:8px" loading="lazy"></iframe>
    </div>
</div>

<script>
/* -------------------- Data & State -------------------- */
const driverNames = ["Ramesh","Suresh","Prakash","Naresh","Kumar","Ravi","Ganesh","Anil","Harish"];
const studentNames = ["Abhi Varun","Thanuja","Surya","Nikhil","Chinna Ram","Harini","Prasanna","Mahesh Babu"];

const buses = Array.from({ length: 50 }, (_, i) => ({
    number: "BUS-" + (100 + i),
    eta: Math.floor(Math.random() * 25) + 2,
    lat: 17.10 + Math.random() * 0.06,
    lng: 82.10 + Math.random() * 0.06,
    driver: driverNames[i % driverNames.length],
    mobile: "98765" + String(10000 + i)
}));

let allottedBus = null;      // assigned to logged-in user / child
let isParent = false;
let studentName = "";
let notifyEnabled = false;

/* -------------------- Theme (parent/student) -------------------- */
function applyTheme() {
    const loginType = document.getElementById("loginType").value;
    const body = document.getElementById("body");
    const loginBox = document.getElementById("loginPage");
    if (loginType === "parent") {
        body.classList.add("parent-theme");
        loginBox.classList.add("parent-box");
    } else {
        body.classList.remove("parent-theme");
        loginBox.classList.remove("parent-box");
    }
}

/* -------------------- Login -------------------- */
function login() {
    const ID = document.getElementById("loginID").value.trim();
    const pass = document.getElementById("password").value.trim();
    const loginType = document.getElementById("loginType").value;
    if (!ID || !pass) { alert("Please enter login ID and password."); return; }

    isParent = loginType === "parent";
    studentName = studentNames[Math.floor(Math.random() * studentNames.length)];
    allottedBus = buses[Math.floor(Math.random() * buses.length)];

    // Greeting
    const greet = document.getElementById("greeting");
    if (isParent) {
        greet.innerHTML = `ðŸ‘‹ Hello, Parent of <strong>${studentName}</strong>`;
    } else {
        greet.innerHTML = `ðŸ‘‹ Welcome, <strong>${studentName}</strong>`;
    }

    // Allotted text
    document.getElementById("allottedText").innerHTML = isParent
        ? `Your son/daughter is allotted: <b>${allottedBus.number}</b>`
        : `You are allotted: <b>${allottedBus.number}</b>`;

    // show dashboard
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("dashboard").style.display = "block";

    // show initial bus
    showBus(allottedBus);
}

/* -------------------- Search + suggestions -------------------- */
function searchBus() {
    const val = document.getElementById("searchBar").value.trim().toUpperCase();
    const box = document.getElementById("suggestions");
    if (!val) { box.style.display = "none"; showBus(allottedBus); return; }

    const matches = buses.filter(b => b.number.includes(val));
    if (matches.length === 0) {
        box.innerHTML = "<div class='suggest-item'>No buses found</div>";
        box.style.display = "block";
        return;
    }
    box.innerHTML = matches.map(b => `<div class="suggest-item" onclick="selectBus('${b.number}')">${b.number}</div>`).join("");
    box.style.display = "block";
}
function selectBus(num) {
    document.getElementById("searchBar").value = num;
    document.getElementById("suggestions").style.display = "none";
    const bus = buses.find(b => b.number === num);
    if (bus) showBus(bus);
}

/* -------------------- Show bus on map + info -------------------- */
function showBus(bus) {
    // info panel
    document.getElementById("busAllotted").textContent = allottedBus ? allottedBus.number : "â€”";
    document.getElementById("busNumber").textContent = bus.number;
    if (isParent) {
        // simulate ETA to home (child) by adding small offset
        const etaHome = Math.max(1, bus.eta + 2);
        document.getElementById("eta").innerHTML = `${etaHome} minutes (to home)`;
    } else {
        document.getElementById("eta").innerHTML = `${bus.eta} minutes`;
    }
    document.getElementById("driver").textContent = bus.driver;
    document.getElementById("mobile").textContent = bus.mobile;

    // notify check
    if (notifyEnabled && bus.eta < 3) {
        alert("ðŸ”” Your bus will arrive in less than 3 minutes!");
        notifyEnabled = false;
    }

    // live map embed (no API key required) â€” center on bus
    const gmap = document.getElementById("gmap");
    gmap.src = `https://www.google.com/maps?q=${bus.lat},${bus.lng}&z=15&output=embed`;
}

/* -------------------- Notify -------------------- */
function notifyUser() {
    notifyEnabled = true;
    alert("âœ… You will be notified (demo).");
}

/* -------------------- Optimized Route Panel -------------------- */
function openRoutePanel() {
    const num = document.getElementById("busNumber").textContent;
    const bus = buses.find(b => b.number === num) || allottedBus;

    if (!bus) { alert("No bus selected."); return; }

    const origin = `${bus.lat},${bus.lng}`;

    // Example destination (student home) â€“ nearby simulated point
    const destLat = (bus.lat + 0.02).toFixed(6);
    const destLng = (bus.lng - 0.02).toFixed(6);
    const dest = `${destLat},${destLng}`;

    // FULL GOOGLE MAPS WEBSITE, NOT EMBED (no API)
    const routeMap = document.getElementById("routeMap");
    routeMap.src = `https://www.google.com/maps?q=${bus.lat},${bus.lng}&z=15&output=embed`;

    const panel = document.getElementById("routePanel");
    panel.style.right = "0px";
    panel.setAttribute("aria-hidden", "false");
}

function closeRoutePanel() {
    const panel = document.getElementById("routePanel");
    panel.style.right = "-420px";
    panel.setAttribute("aria-hidden", "true");
}

/* Initialize applyTheme default */
applyTheme();
</script>
</body>
</html>


